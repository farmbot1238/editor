<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Farm Bot - Editor Mode</title>
<style>
:root {
    --glass: rgba(0,0,0,0.55);
    --white: #fff;
    --green: #1b5e20;
    --yellow: #ffeb3b;
    --black: #000;
    --hover-green: #4caf50;
    --purple: #7b1fa2;
    --hover-purple: #9c27b0;
    --edit-blue: #2196f3;
    --edit-hover: #1976d2;
    --delete-red: #f44336;
}
* { margin:0; padding:0; box-sizing:border-box; font-family: Arial, sans-serif; }
body, html { height: 100%; scroll-behavior: smooth; }

/* Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
.login-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--green), var(--edit-blue));
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
}
.login-box {
    background: white;
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    text-align: center;
    width: 90%;
    max-width: 400px;
}
.login-box h1 {
    color: var(--green);
    margin-bottom: 30px;
}
.login-input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
}
.login-btn {
    width: 100%;
    padding: 12px;
    background: var(--green);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: bold;
}
.login-btn:hover {
    background: var(--hover-green);
}
.login-error {
    color: var(--delete-red);
    margin-top: 10px;
    display: none;
}

/* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø±ÙŠØ± */
.editor-header {
    position: fixed;
    top: 0; left: 0; right: 0;
    background: linear-gradient(135deg, var(--edit-blue), var(--purple));
    color: white;
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 9999;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.editor-title {
    font-weight: bold;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}
.editor-controls {
    display: flex;
    gap: 8px;
}
.editor-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 5px;
}
.editor-btn:hover {
    background: rgba(255,255,255,0.3);
}
.save-btn {
    background: var(--green);
}
.save-btn:hover {
    background: var(--hover-green);
}
.logout-btn {
    background: var(--delete-red);
}
.logout-btn:hover {
    background: #d32f2f;
}

/* Ø±Ø³Ø§Ø¦Ù„ */
.message {
    position: fixed;
    top: 60px;
    right: 20px;
    padding: 12px 20px;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    z-index: 10000;
    display: none;
    animation: slideIn 0.3s ease;
}
@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
.message.show {
    display: block;
}
.message.success {
    background: #4caf50;
}
.message.error {
    background: var(--delete-red);
}
.message.info {
    background: var(--edit-blue);
}

/* Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù†ÙØ³Ù‡ (Ù†ÙØ³ Ø£Ù†Ù…Ø§Ø· index.html) */
.home {
    background: url('FARBOT.jpeg') no-repeat center center/cover;
    height: 100vh;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    color: var(--white); text-align:center;
    margin-top: 60px;
}
.glass-box { background: var(--glass); padding:30px; border-radius:15px; max-width:600px; width:90%; }
h1 { font-size:2rem; margin-bottom:15px; }
.menu { margin:20px 0; }
.menu button {
    display:block; width:200px; margin:10px auto; padding:12px; font-size:1rem;
    border:none; border-radius:10px; background: var(--green); color: var(--white); cursor:pointer; transition:0.3s;
}
.menu button:hover { background: var(--hover-green); box-shadow: 0 0 15px var(--hover-green); }

#suggestions {
    background: var(--black); padding:30px; border-radius:15px 15px 0 0; margin:0; width:100%;
    color: var(--white); text-align:center;
}
#suggestions h2 { margin-bottom:10px; }
#suggestions p { margin-bottom:20px; }
#suggestions input, #suggestions button { padding:10px; margin:5px; border:none; border-radius:8px; }
#suggestions input { width:250px; }
#suggestions button { background: var(--green); color: var(--white); cursor:pointer; }
#suggestions button:hover { background: var(--hover-green); }

.page {
    display:none;
    background: url('FARBOT2.jpeg') no-repeat center center/cover;
    background-size: cover;
    height:100vh; padding:40px; color: var(--white); overflow-y:auto;
    margin-top: 60px;
}
.page .content {
    background: var(--glass); padding:20px; border-radius:15px; max-width:800px; margin:auto;
}
.page button { margin-top:20px; padding:10px 20px; background: var(--green); border:none; border-radius:8px; color: var(--white); cursor:pointer; }
.page button:hover { background: var(--hover-green); }

.lang-toggle { 
    position:absolute; 
    top:80px;
    right:20px; 
    background: var(--glass); 
    color: var(--white); 
    border:none; 
    padding:8px 15px; 
    border-radius:10px; 
    cursor:pointer; 
    z-index: 9998;
}

.threeD-title { font-size:2rem; text-align:center; margin-bottom:15px; }
.threeD-title .farm { color: var(--yellow); }
.threeD-title .bot { color: var(--green); }
.teachable-title { font-size:2rem; text-align:center; margin-bottom:15px; }
.teachable-title .teachable { color: var(--yellow); }
.teachable-title .machine { color: var(--purple); }
.functions-list { text-align: left; margin: 20px 0; }
.function-item { 
    margin: 15px 0; 
    padding: 10px; 
    background: rgba(255,255,255,0.1); 
    border-radius: 8px;
    position: relative;
}

.pdf-download-btn {
    display: inline-block;
    margin: 15px 0;
    padding: 12px 25px;
    background: #d32f2f;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    transition: background 0.3s;
}
.pdf-download-btn:hover { background: #b71c1c; }
.pdf-icon { margin-right: 8px; }
.teachable-btn {
    display: inline-block;
    margin: 15px 0;
    padding: 12px 25px;
    background: var(--purple);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: bold;
    transition: background 0.3s;
    border: none;
    cursor: pointer;
}
.teachable-btn:hover { background: var(--hover-purple); box-shadow: 0 0 15px var(--hover-purple); }
.teachable-icon { margin-right: 8px; }
.instagram-link {
    display: inline-block;
    margin-top: 20px;
    color: var(--white);
    text-decoration: none;
    font-size: 1.1rem;
    transition: color 0.3s;
}
.instagram-link:hover { color: #e4405f; }
.instagram-icon { margin-right: 8px; font-size: 1.2rem; }

/* Ø¹Ù†Ø§ØµØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ­Ø±ÙŠØ± */
.editable {
    cursor: pointer;
    position: relative;
    transition: all 0.3s;
    padding: 2px 4px;
    border-radius: 3px;
}
.editable:hover {
    background: rgba(33, 150, 243, 0.2);
    outline: 2px dashed var(--edit-blue);
}
.editable::after {
    content: 'âœï¸';
    position: absolute;
    top: -8px;
    right: -8px;
    background: var(--edit-blue);
    color: white;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s;
}
.editable:hover::after {
    opacity: 1;
}

/* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ø±ÙŠØ± */
.edit-modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 20000;
}
.edit-modal-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}
.edit-modal h3 {
    color: var(--edit-blue);
    margin-bottom: 20px;
    text-align: center;
}
.edit-textarea {
    width: 100%;
    height: 150px;
    padding: 15px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    margin-bottom: 20px;
    resize: vertical;
    font-family: Arial, sans-serif;
}
.edit-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

/* Ø£Ø²Ø±Ø§Ø± ØªØ­ÙƒÙ… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
.section-controls {
    position: absolute;
    top: 5px;
    right: 5px;
    display: flex;
    gap: 5px;
}
.section-btn {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.edit-section-btn {
    background: var(--edit-blue);
    color: white;
}
.delete-section-btn {
    background: var(--delete-red);
    color: white;
}
</style>
</head>
<body>

<!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginScreen" class="login-overlay">
    <div class="login-box">
        <h1>ğŸ” Farm Bot Editor</h1>
        <p style="color: #666; margin-bottom: 20px;">Enter password to edit website</p>
        <input type="password" id="passwordInput" class="login-input" placeholder="Enter password" autofocus>
        <button onclick="login()" class="login-btn">Login</button>
        <p id="loginError" class="login-error">Wrong password! Try: admin123</p>
        <p style="margin-top: 15px; font-size: 12px; color: #888;">Default password: admin123</p>
    </div>
</div>

<!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø±ÙŠØ± -->
<div id="editorHeader" class="editor-header" style="display: none;">
    <div class="editor-title">
        <span>âœï¸</span>
        <span>Editor Mode</span>
    </div>
    <div class="editor-controls">
        <button class="editor-btn save-btn" onclick="saveAllChanges()">
            <span>ğŸ’¾</span>
            <span>Save All</span>
        </button>
        <button class="editor-btn" onclick="addNewSection('what')">
            <span>â•</span>
            <span>Add Function</span>
        </button>
        <button class="editor-btn logout-btn" onclick="logout()">
            <span>ğŸšª</span>
            <span>Logout</span>
        </button>
    </div>
</div>

<div id="message" class="message"></div>

<!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ù†ÙØ³ index.html Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© class="editable") -->
<section class="home" id="home" style="display: none;">
    <button class="lang-toggle" onclick="toggleLang()">AR</button>
    <div class="glass-box">
        <h1 id="title" class="editable" onclick="editText('main_title', this)">FARM 8OT</h1>
        <p id="subtitle" class="editable" onclick="editText('main_subtitle', this)">Revolution in the world of agriculture</p>
        <div class="menu">
            <button onclick="openPage('about')" id="about-btn">About</button>
            <button onclick="openPage('what')" id="what-btn">What it does</button>
            <button id="contact-btn">Contact</button>
            <button onclick="open3DPage()" id="threeD-btn">3D</button>
            <button onclick="openPage('teachable')" id="teachable-btn">Teachable Machine Model</button>
            <button onclick="openPage('download')" id="download-btn">Download PDF</button>
        </div>
        <a href="#" id="instagram-link" class="instagram-link" target="_blank">
            <span class="instagram-icon">ğŸ“·</span>
            <span id="instagram-text" class="editable" onclick="editText('instagram_text', this)">Follow us on Instagram</span>
        </a>
    </div>
</section>

<div id="suggestions" style="display: none;">
    <h2 id="suggest-title" class="editable" onclick="editText('suggest_title', this)">Suggestions</h2>
    <p id="suggest-text" class="editable" onclick="editText('suggest_text', this)">We believe in any suggestion that can develop and enhance our project.</p>
    <p><strong id="phone-text" class="editable" onclick="editText('phone_text', this)">Phone:</strong> 
       <span id="phone-number" class="editable" onclick="editText('contact_phone', this)">+962 7XXXXXXXX</span>
    </p>
    <form onsubmit="event.preventDefault(); sendSuggestion();">
        <input type="text" id="suggest-input" placeholder="Write your suggestion..." required>
        <button type="submit" id="send-btn">Send</button>
    </form>
</div>

<section class="page" id="about" style="display: none;">
    <div class="content">
        <h2 id="about-page-title" class="editable" onclick="editText('about_title', this)">About</h2>
        <p id="about-text" class="editable" onclick="editText('about_text', this)">Loading...</p>
        <button onclick="closePage('about')" id="exit-about-btn">Exit</button>
    </div>
</section>

<section class="page" id="what" style="display: none;">
    <div class="content">
        <h2 id="what-title" class="editable" onclick="editText('what_title', this)">What it does</h2>
        <div class="functions-list" id="functions-content">
            Loading...
        </div>
        <div style="text-align: center; margin: 20px 0;">
            <button class="editor-btn" onclick="addNewSection('what')">
                <span>â•</span>
                <span>Add New Function</span>
            </button>
        </div>
        <button onclick="closePage('what')" id="exit-what-btn">Exit</button>
    </div>
</section>

<section class="page" id="teachable" style="display: none;">
    <div class="content">
        <h2 class="teachable-title" id="teachable-page-title">
            <span class="teachable editable" onclick="editText('teachable_title_part1', this)">Teachable</span> 
            <span class="machine editable" onclick="editText('teachable_title_part2', this)">Machine</span>
        </h2>
        <p id="teachable-text" class="editable" onclick="editText('teachable_text', this)">Loading...</p>
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="openTeachableModel()" class="teachable-btn">
                <span class="teachable-icon">ğŸ¤–</span>
                <span id="teachable-btn-text" class="editable" onclick="editText('teachable_btn_text', this)">Open Teachable Machine Model</span>
            </button>
        </div>
        <div id="teachable-info">
            <h3 id="features-title" class="editable" onclick="editText('features_title', this)">Features:</h3>
            <div class="functions-list" id="teachable-features">
                Loading...
            </div>
        </div>
        <div style="text-align: center; margin: 20px 0;">
            <button class="editor-btn" onclick="addNewSection('teachable')">
                <span>â•</span>
                <span>Add New Feature</span>
            </button>
        </div>
        <p id="teachable-note" class="editable" onclick="editText('teachable_note', this)">Loading...</p>
        <button onclick="closePage('teachable')" id="exit-teachable-btn">Exit</button>
    </div>
</section>

<section class="page" id="download" style="display: none;">
    <div class="content">
        <h2 id="download-title" class="editable" onclick="editText('download_title', this)">Download</h2>
        <p id="download-text" class="editable" onclick="editText('download_text', this)">Loading...</p>
        <a href="#" id="pdf-download-link" class="pdf-download-btn" download>
            <span class="pdf-icon">ğŸ“„</span>
            <span id="download-btn-text" class="editable" onclick="editText('download_btn_text', this)">Download Farm Bot PDF</span>
        </a>
        <p id="file-info" class="editable" onclick="editText('file_info', this)">Loading...</p>
        <button onclick="closePage('download')" id="exit-download-btn">Exit</button>
    </div>
</section>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ø±ÙŠØ± -->
<div id="editModal" class="edit-modal">
    <div class="edit-modal-content">
        <h3 id="editModalTitle">Edit Text</h3>
        <textarea id="editModalTextarea" class="edit-textarea" placeholder="Enter text..."></textarea>
        <div class="edit-buttons">
            <button class="editor-btn" onclick="closeEditModal()">Cancel</button>
            <button class="editor-btn save-btn" onclick="saveEditedText()">Save</button>
        </div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… -->
<div id="addSectionModal" class="edit-modal">
    <div class="edit-modal-content">
        <h3 id="addSectionTitle">Add New Section</h3>
        <input type="text" id="sectionTitleInput" class="login-input" placeholder="Section Title" style="margin-bottom: 10px;">
        <textarea id="sectionContentInput" class="edit-textarea" placeholder="Section Content"></textarea>
        <div class="edit-buttons">
            <button class="editor-btn" onclick="closeAddSectionModal()">Cancel</button>
            <button class="editor-btn save-btn" onclick="saveNewSection()">Add Section</button>
        </div>
    </div>
</div>

<script>
// ============ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase ============
const SUPABASE_URL = 'https://etwthswhhplfnvejhofu.supabase.co';
const SUPABASE_KEY = 'sb_publishable_7nzi8jmfH7ONhR-7GJKxOg_xKS77RnY';

// ============ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø­Ø±Ø± ============
const EDITOR_PASSWORD = "admin123"; // ØºÙŠØ±Ù‡Ø§ Ø¥Ø°Ø§ Ø¨Ø¯Ùƒ

// ============ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ============
let textData = { en: {}, ar: {} };
let currentLang = 'en';
let websiteSections = [];
let websiteFiles = [];
let unsavedChanges = {};
let currentEditElement = null;
let currentEditKey = null;
let currentPageForSection = null;
let supabaseClient = null;

// ============ Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ============
function login() {
    const password = document.getElementById('passwordInput').value;
    const errorElement = document.getElementById('loginError');
    
    if (password === EDITOR_PASSWORD) {
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('editorHeader').style.display = 'flex';
        document.getElementById('home').style.display = 'flex';
        document.getElementById('suggestions').style.display = 'block';
        
        // Ø­ÙØ¸ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„
        localStorage.setItem('editor_logged_in', 'true');
        localStorage.setItem('editor_password', EDITOR_PASSWORD);
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        initializeSupabase();
        
        showMessage('Welcome to Editor Mode!', 'success');
    } else {
        errorElement.style.display = 'block';
        errorElement.textContent = 'Wrong password! Try: ' + EDITOR_PASSWORD;
        document.getElementById('passwordInput').value = '';
        document.getElementById('passwordInput').focus();
    }
}

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('editor_logged_in');
        localStorage.removeItem('editor_password');
        window.location.href = 'index.html';
    }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
if (localStorage.getItem('editor_logged_in') === 'true' && 
    localStorage.getItem('editor_password') === EDITOR_PASSWORD) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('editorHeader').style.display = 'flex';
    document.getElementById('home').style.display = 'flex';
    document.getElementById('suggestions').style.display = 'block';
    initializeSupabase();
}

// ============ ØªÙ‡ÙŠØ¦Ø© Supabase ============
function initializeSupabase() {
    // ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Supabase
    if (!window.supabase) {
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/@supabase/supabase-js@2';
        script.onload = function() {
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            loadAllData();
        };
        script.onerror = function() {
            showMessage('Error loading Supabase library', 'error');
            loadDefaultData();
        };
        document.head.appendChild(script);
    } else {
        supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        loadAllData();
    }
}

// ============ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ============
async function loadAllData() {
    showMessage('Loading data...', 'info');
    
    try {
        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ
        const { data: texts, error: textsError } = await supabaseClient
            .from('website_texts')
            .select('*');
        
        if (textsError) throw textsError;
        
        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        const { data: sections, error: sectionsError } = await supabaseClient
            .from('website_sections')
            .select('*')
            .order('order_index');
        
        if (sectionsError) {
            console.warn('Could not load sections:', sectionsError);
            websiteSections = [];
        } else {
            websiteSections = sections || [];
        }
        
        // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
        const { data: files, error: filesError } = await supabaseClient
            .from('website_files')
            .select('*');
        
        if (filesError) {
            console.warn('Could not load files:', filesError);
            websiteFiles = [];
        } else {
            websiteFiles = files || [];
        }
        
        // ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        organizeData(texts);
        
        showMessage('Data loaded successfully!', 'success');
        
    } catch (error) {
        console.error('Error loading data:', error);
        showMessage('Error loading data', 'error');
        loadDefaultData();
    }
}

function organizeData(texts) {
    textData = { en: {}, ar: {} };
    
    if (texts && texts.length > 0) {
        texts.forEach(item => {
            if (item.key) {
                textData.en[item.key] = item.value_en || item.value || '';
                textData.ar[item.key] = item.value_ar || item.value || item.value_en || '';
            }
        });
    }
    
    updateWebsiteContent();
}

// ============ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ============
function updateWebsiteContent() {
    const lang = currentLang;
    
    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØµÙˆØµ
    updateElement('title', textData[lang].main_title);
    updateElement('subtitle', textData[lang].main_subtitle);
    updateElement('about-btn', textData[lang].about_btn);
    updateElement('what-btn', textData[lang].what_btn);
    updateElement('contact-btn', textData[lang].contact_btn);
    updateElement('threeD-btn', textData[lang].threeD_btn);
    updateElement('teachable-btn', textData[lang].teachable_btn);
    updateElement('download-btn', textData[lang].download_btn);
    updateElement('instagram-text', textData[lang].instagram_text);
    
    updateElement('about-page-title', textData[lang].about_title);
    updateElement('about-text', textData[lang].about_text);
    updateElement('what-title', textData[lang].what_title);
    updateElement('teachable-text', textData[lang].teachable_text);
    updateElement('teachable-btn-text', textData[lang].teachable_btn_text);
    updateElement('features-title', textData[lang].features_title);
    updateElement('teachable-note', textData[lang].teachable_note);
    updateElement('download-title', textData[lang].download_title);
    updateElement('download-text', textData[lang].download_text);
    updateElement('download-btn-text', textData[lang].download_btn_text);
    updateElement('file-info', textData[lang].file_info);
    updateElement('suggest-title', textData[lang].suggest_title);
    updateElement('suggest-text', textData[lang].suggest_text);
    updateElement('phone-text', textData[lang].phone_text);
    updateElement('phone-number', textData[lang].contact_phone);
    updateElement('send-btn', textData[lang].send_btn);
    updateElement('exit-about-btn', textData[lang].exit_btn);
    updateElement('exit-what-btn', textData[lang].exit_btn);
    updateElement('exit-teachable-btn', textData[lang].exit_btn);
    updateElement('exit-download-btn', textData[lang].exit_btn);
    
    document.getElementById('suggest-input').placeholder = textData[lang].suggest_placeholder || 'Write your suggestion...';
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
    if (textData.en.contact_url) {
        document.getElementById('contact-btn').onclick = () => window.open(textData.en.contact_url, '_blank');
    }
    if (textData.en.instagram_url) {
        document.getElementById('instagram-link').href = textData.en.instagram_url;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    updateSections();
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„ÙØ§Øª
    const pdfFile = websiteFiles.find(f => f.file_type === 'pdf');
    if (pdfFile) {
        document.getElementById('pdf-download-link').href = pdfFile.file_url;
        document.getElementById('pdf-download-link').download = pdfFile.file_name;
    }
}

function updateElement(id, value) {
    const element = document.getElementById(id);
    if (element && value !== undefined && value !== null) {
        element.textContent = value;
    }
}

function updateSections() {
    // ØµÙØ­Ø© What it does
    const whatContainer = document.getElementById('functions-content');
    if (whatContainer) {
        whatContainer.innerHTML = '';
        
        const whatSections = websiteSections.filter(s => s.page === 'what');
        
        if (whatSections.length === 0) {
            whatContainer.innerHTML = '<p>No functions available</p>';
        } else {
            whatSections.forEach(section => {
                const div = createSectionElement(section);
                whatContainer.appendChild(div);
            });
        }
    }
    
    // ØµÙØ­Ø© Teachable Machine
    const teachableContainer = document.getElementById('teachable-features');
    if (teachableContainer) {
        teachableContainer.innerHTML = '';
        
        const teachableSections = websiteSections.filter(s => s.page === 'teachable');
        
        if (teachableSections.length === 0) {
            teachableContainer.innerHTML = '<div class="function-item">No features available</div>';
        } else {
            teachableSections.forEach(section => {
                const div = createSectionElement(section);
                teachableContainer.appendChild(div);
            });
        }
    }
}

function createSectionElement(section) {
    const div = document.createElement('div');
    div.className = 'function-item';
    div.setAttribute('data-id', section.id);
    
    const title = currentLang === 'en' ? section.title_en : (section.title_ar || section.title_en);
    const content = currentLang === 'en' ? section.content_en : (section.content_ar || section.content_en);
    
    div.innerHTML = `
        <div class="section-controls">
            <button class="section-btn edit-section-btn" onclick="editExistingSection(${section.id})">âœï¸</button>
            <button class="section-btn delete-section-btn" onclick="deleteSection(${section.id})">ğŸ—‘</button>
        </div>
        <h3>${title}</h3>
        <p>${content}</p>
    `;
    
    return div;
}

// ============ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ø±ÙŠØ± ============
function editText(key, element) {
    currentEditElement = element;
    currentEditKey = key;
    
    document.getElementById('editModalTitle').textContent = `Edit: ${key}`;
    document.getElementById('editModalTextarea').value = element.textContent;
    document.getElementById('editModal').style.display = 'flex';
    document.getElementById('editModalTextarea').focus();
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
    currentEditElement = null;
    currentEditKey = null;
}

function saveEditedText() {
    if (!currentEditElement || !currentEditKey) return;
    
    const newValue = document.getElementById('editModalTextarea').value.trim();
    
    if (!newValue) {
        alert('Text cannot be empty!');
        return;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    currentEditElement.textContent = newValue;
    
    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø¤Ù‚ØªØ§Ù‹
    if (!unsavedChanges.texts) unsavedChanges.texts = {};
    unsavedChanges.texts[currentEditKey] = {
        value_en: currentLang === 'en' ? newValue : (textData.en[currentEditKey] || ''),
        value_ar: currentLang === 'ar' ? newValue : (textData.ar[currentEditKey] || '')
    };
    
    closeEditModal();
    showMessage('Change saved locally. Click "Save All" to update website.', 'info');
}

// ============ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ============
function addNewSection(page) {
    currentPageForSection = page;
    document.getElementById('addSectionTitle').textContent = `Add New ${page === 'what' ? 'Function' : 'Feature'}`;
    document.getElementById('sectionTitleInput').value = '';
    document.getElementById('sectionContentInput').value = '';
    document.getElementById('addSectionModal').style.display = 'flex';
}

function closeAddSectionModal() {
    document.getElementById('addSectionModal').style.display = 'none';
    currentPageForSection = null;
}

async function saveNewSection() {
    const title = document.getElementById('sectionTitleInput').value.trim();
    const content = document.getElementById('sectionContentInput').value.trim();
    
    if (!title) {
        alert('Title is required!');
        return;
    }
    
    try {
        const maxOrder = websiteSections
            .filter(s => s.page === currentPageForSection)
            .reduce((max, s) => Math.max(max, s.order_index), 0);
        
        const { data, error } = await supabaseClient
            .from('website_sections')
            .insert([{
                page: currentPageForSection,
                title_en: title,
                title_ar: title,
                content_en: content,
                content_ar: content,
                order_index: maxOrder + 1,
                is_active: true
            }])
            .select();
        
        if (error) throw error;
        
        closeAddSectionModal();
        await loadAllData();
        showMessage('Section added successfully!', 'success');
        
    } catch (error) {
        console.error('Error adding section:', error);
        showMessage('Error adding section', 'error');
    }
}

async function editExistingSection(sectionId) {
    const section = websiteSections.find(s => s.id === sectionId);
    if (!section) return;
    
    const newTitle = prompt('Edit title:', section.title_en);
    if (newTitle === null) return;
    
    const newContent = prompt('Edit content:', section.content_en);
    if (newContent === null) return;
    
    try {
        const { error } = await supabaseClient
            .from('website_sections')
            .update({
                title_en: newTitle,
                content_en: newContent
            })
            .eq('id', sectionId);
        
        if (error) throw error;
        
        await loadAllData();
        showMessage('Section updated successfully!', 'success');
        
    } catch (error) {
        console.error('Error updating section:', error);
        showMessage('Error updating section', 'error');
    }
}

async function deleteSection(sectionId) {
    if (!confirm('Are you sure you want to delete this section?')) return;
    
    try {
        const { error } = await supabaseClient
            .from('website_sections')
            .delete()
            .eq('id', sectionId);
        
        if (error) throw error;
        
        await loadAllData();
        showMessage('Section deleted successfully!', 'success');
        
    } catch (error) {
        console.error('Error deleting section:', error);
        showMessage('Error deleting section', 'error');
    }
}

// ============ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ============
async function saveAllChanges() {
    if (Object.keys(unsavedChanges.texts || {}).length === 0) {
        showMessage('No changes to save', 'info');
        return;
    }
    
    showMessage('Saving all changes...', 'info');
    
    try {
        for (const [key, data] of Object.entries(unsavedChanges.texts)) {
            const updateData = {
                key: key,
                updated_at: new Date().toISOString()
            };
            
            if (data.value_en) updateData.value_en = data.value_en;
            if (data.value_ar) updateData.value_ar = data.value_ar;
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const { data: existing } = await supabaseClient
                .from('website_texts')
                .select('*')
                .eq('key', key)
                .single();
            
            if (existing) {
                // ØªØ­Ø¯ÙŠØ«
                await supabaseClient
                    .from('website_texts')
                    .update(updateData)
                    .eq('id', existing.id);
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
                await supabaseClient
                    .from('website_texts')
                    .insert([updateData]);
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await loadAllData();
        unsavedChanges = {};
        showMessage('All changes saved successfully! Website updated.', 'success');
        
    } catch (error) {
        console.error('Error saving changes:', error);
        showMessage('Error saving changes: ' + error.message, 'error');
    }
}

// ============ ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ============
function showMessage(text, type) {
    const msg = document.getElementById('message');
    msg.textContent = text;
    msg.className = `message ${type} show`;
    
    setTimeout(() => {
        msg.className = 'message';
    }, 3000);
}

function toggleLang() {
    currentLang = currentLang === 'en' ? 'ar' : 'en';
    document.querySelector('.lang-toggle').textContent = currentLang === 'en' ? 'AR' : 'EN';
    document.body.style.direction = currentLang === 'ar' ? 'rtl' : 'ltr';
    updateWebsiteContent();
}

function openPage(pageId) {
    document.getElementById('home').style.display = 'none';
    document.getElementById('suggestions').style.display = 'none';
    document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
    
    const page = document.getElementById(pageId);
    page.style.display = 'block';
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¥Ø°Ø§ Ù„Ø²Ù…
    if (pageId === 'what' || pageId === 'teachable') {
        updateSections();
    }
}

function closePage(pageId) {
    document.getElementById(pageId).style.display = 'none';
    document.getElementById('home').style.display = 'flex';
    document.getElementById('suggestions').style.display = 'block';
}

function open3DPage() {
    const url = textData.en.threeD_url || 'https://farmbot1238.github.io/3D/';
    window.open(url, '_blank');
}

function openTeachableModel() {
    const url = textData.en.teachable_url || 'https://farmbot1238.github.io/tomato/';
    window.open(url, '_blank');
}

async function sendSuggestion() {
    const suggestion = document.getElementById('suggest-input').value.trim();
    if (!suggestion) {
        alert('Please write your suggestion first');
        return;
    }
    
    try {
        const { error } = await supabaseClient
            .from('website_suggestions')
            .insert([{ suggestion: suggestion }]);
        
        if (error) throw error;
        
        alert('Thank you for your suggestion!');
        document.getElementById('suggest-input').value = '';
        
    } catch (error) {
        console.error('Error saving suggestion:', error);
        alert('Error saving suggestion');
    }
}

// ============ Ø¨ÙŠØ§Ù†Ø§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ============
function loadDefaultData() {
    textData = {
        en: {
            main_title: 'FARM 8OT',
            main_subtitle: 'Revolution in the world of agriculture',
            about_btn: 'About',
            what_btn: 'What it does',
            contact_btn: 'Contact',
            threeD_btn: '3D',
            teachable_btn: 'Teachable Machine Model',
            download_btn: 'Download PDF',
            instagram_text: 'Follow us on Instagram',
            about_title: 'About',
            about_text: 'Farm Bot is an intelligent agricultural robot...',
            what_title: 'What it does',
            teachable_title_part1: 'Teachable',
            teachable_title_part2: 'Machine',
            teachable_text: 'Experience our AI-powered plant disease detection model...',
            teachable_btn_text: 'Open Teachable Machine Model',
            features_title: 'Features:',
            teachable_note: 'Note: The model will open in a new window...',
            download_title: 'Download Farm Bot PDF',
            download_text: 'Download our comprehensive PDF document...',
            download_btn_text: 'Download Farm Bot PDF',
            file_info: 'File size: 1.2 MB | Format: PDF',
            suggest_title: 'Suggestions',
            suggest_text: 'We believe in any suggestion that can develop and enhance our project.',
            phone_text: 'Phone:',
            contact_phone: '+962 7XXXXXXXX',
            send_btn: 'Send',
            exit_btn: 'Exit'
        },
        ar: {
            main_title: 'FARM 8OT',
            main_subtitle: 'Ø«ÙˆØ±Ø© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø²Ø±Ø§Ø¹Ø©',
            about_btn: 'Ø­ÙˆÙ„',
            what_btn: 'Ù…Ø§Ø°Ø§ ÙŠÙØ¹Ù„',
            contact_btn: 'ØªÙˆØ§ØµÙ„',
            threeD_btn: '3D',
            teachable_btn: 'Ù†Ù…ÙˆØ°Ø¬ Teachable Machine',
            download_btn: 'ØªØ­Ù…ÙŠÙ„ PDF',
            instagram_text: 'ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…',
            about_title: 'Ø­ÙˆÙ„',
            about_text: 'Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ù‡Ùˆ Ø±ÙˆØ¨ÙˆØª Ø²Ø±Ø§Ø¹ÙŠ Ø°ÙƒÙŠ...',
            what_title: 'Ù…Ø§Ø°Ø§ ÙŠÙØ¹Ù„',
            teachable_title_part1: 'Teachable',
            teachable_title_part2: 'Machine',
            teachable_text: 'Ø¬Ø±Ø¨ Ù†Ù…ÙˆØ°Ø¬Ù†Ø§ Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù†Ø¨Ø§ØªØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...',
            teachable_btn_text: 'ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Teachable Machine',
            features_title: 'Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:',
            teachable_note: 'Ù…Ù„Ø§Ø­Ø¸Ø©: Ø³ÙŠØªÙ… ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©...',
            download_title: 'ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF Ù„Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ©',
            download_text: 'Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ ÙˆØ«ÙŠÙ‚Ø© PDF Ø§Ù„Ø´Ø§Ù…Ù„Ø©...',
            download_btn_text: 'ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDF Ù„Ù„Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ©',
            file_info: 'Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: 1.2 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª | Ø§Ù„ØµÙŠØºØ©: PDF',
            suggest_title: 'Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',
            suggest_text: 'Ù†Ø­Ù† Ù†Ø¤Ù…Ù† Ø¨Ø£ÙŠ Ø§Ù‚ØªØ±Ø§Ø­ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØ·ÙˆØ± ÙˆÙŠØ¹Ø²Ø² Ù…Ø´Ø±ÙˆØ¹Ù†Ø§.',
            phone_text: 'Ù‡Ø§ØªÙ:',
            contact_phone: '+962 7XXXXXXXX',
            send_btn: 'Ø¥Ø±Ø³Ø§Ù„',
            exit_btn: 'Ø®Ø±ÙˆØ¬'
        }
    };
    
    websiteSections = [];
    websiteFiles = [];
    
    updateWebsiteContent();
    showMessage('Using default data (no database connection)', 'info');
}
</script>
</body>
</html>
